build:
  box: python:2.7
  steps:

    # A step that sets up the python virtual environment
    - virtualenv:
        name: setup virtual environment
        install_wheel: false # Enable wheel to speed up builds (experimental)

    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "wheel"

    # checking python version
    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    # running tests
    - script:
        name: test
        code: |
          tox -e py27

    # making package
    - script:
        name: package_wheel
        code: |
          python setup.py bdist_wheel
          ls -al dist/*whl

    # copy binary to a location that gets passed along to next pipelines
    - script:
        name: copy binary
        code: cp dist/*whl "$WERCKER_OUTPUT_DIR"

# ----- testing wheel ------
# debian - testing

test_debian_testing_py2:
  box: debian:testing

  steps:
    - script:
        name: prerequisites
        code: |
          apt-get update
          apt-get install -qq -y --no-install-recommends python-pip
          python -V
          pip -V

    - script:
        name: package_install
        code: |
          pip install setuptools
          pip install /pipeline/source/beprof-*.whl

    # some dummy tests for now
    - script:
        name: test installed package
        code: |
          echo 'running: python -c "import beprof"'
          python -c 'import beprof'
          echo 'running: python -c "from beprof.curve import Curve"'
          python -c 'from beprof.curve import Curve'
          echo 'running: python -c "from beprof.profile import Profile"'
          python -c 'from beprof.profile import Profile'
          echo "all done"

test_debian_testing_py3:
  box: debian:testing

  steps:
    - script:
        name: prerequisites
        code: |
          apt-get update
          apt-get install -qq -y --no-install-recommends python3-pip
          python3 -V
          pip3 -V

    - script:
        name: package_install
        code: |
          pip3 install setuptools
          pip3 install /pipeline/source/beprof-*.whl

    # some dummy tests for now
    - script:
        name: test installed package
        code: |
          echo 'running: python -c "import beprof"'
          python3 -c 'import beprof'
          echo 'running: python -c "from beprof.curve import Curve"'
          python3 -c 'from beprof.curve import Curve'
          echo 'running: python -c "from beprof.profile import Profile"'
          python3 -c 'from beprof.profile import Profile'
          echo "all done"

# debian 8 jessie

test_debian_jessie_py2:
  box: debian:jessie

  steps:
    - script:
        name: prerequisites
        code: |
          apt-get update
          apt-get install -qq -y --no-install-recommends python-pip
          python -V
          pip -V
          pip install --upgrade --no-deps --ignore-installed pip
          pip -V

    - script:
        name: package_install
        code: |
          pip install setuptools
          pip install /pipeline/source/beprof-*.whl

    # some dummy tests for now
    - script:
        name: test installed package
        code: |
          echo 'running: python -c "import beprof"'
          python -c 'import beprof'
          echo 'running: python -c "from beprof.curve import Curve"'
          python -c 'from beprof.curve import Curve'
          echo 'running: python -c "from beprof.profile import Profile"'
          python -c 'from beprof.profile import Profile'
          echo "all done"


test_debian_jessie_py3:
  box: debian:jessie

  steps:
    - script:
        name: prerequisites
        code: |
          apt-get update
          apt-get install -qq -y --no-install-recommends python3-pip
          python3 -V
          pip3 -V
          pip install --upgrade --no-deps --ignore-installed pip
          pip -V

    - script:
        name: package_install
        code: |
          pip3 install setuptools
          pip3 install /pipeline/source/beprof-*.whl

    # some dummy tests for now
    - script:
        name: test installed package
        code: |
          echo 'running: python -c "import beprof"'
          python3 -c 'import beprof'
          echo 'running: python -c "from beprof.curve import Curve"'
          python3 -c 'from beprof.curve import Curve'
          echo 'running: python -c "from beprof.profile import Profile"'
          python3 -c 'from beprof.profile import Profile'
          echo "all done"


# ------- testing on python boxes -------

test-python27:
  box: python:2.7
  steps:
    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "pytest"

    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: run pytest
        code: python -m pytest

test-python32:
  box: python:3.2
  steps:
    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "wheel"

    # checking python version
    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: run pytest
        code: python -m pytest

test-python33:
  box: python:3.3

  # make a source package in standard python box
  steps:
    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "wheel"

    # checking python version
    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: run pytest
        code: python -m pytest

test-python34:
  box: python:3.4
  steps:
    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "wheel"

    # checking python version
    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: run pytest
        code: python -m pytest

test-python35:
  box: python:3.5
  steps:
    # installing necessary requirements
    - pip-install:
        requirements_file: "requirements.txt"
        extra_args: "-rtests/requirements-test.txt"
        packages_list: "wheel"

    # checking python version
    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: run pytest
        code: python -m pytest